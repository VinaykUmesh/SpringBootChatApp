<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Spring Boot Chat</title>
    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="container py-4">
<h2 class="mb-3">Spring Boot WebSocket Chat</h2>

<!-- Username -->
<div class="mb-3">
    <input type="text" id="username" class="form-control" placeholder="Enter your name">
</div>

<!-- Chat window -->
<div id="chat-box" class="border rounded p-3 mb-3" style="height:300px; overflow-y:auto;"></div>

<!-- Message input -->
<div class="input-group">
    <input type="text" id="message" class="form-control" placeholder="Type a message">
    <button class="btn btn-primary" onclick="sendMessage()">Send</button>
</div>

<!-- SockJS + STOMP -->
<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>

<script>
    let stompClient = null;

    function connect() {
        let socket = new SockJS('/chat'); // same as backend endpoint
        stompClient = Stomp.over(socket);
        stompClient.connect({}, function (frame) {
            console.log('Connected: ' + frame);
            stompClient.subscribe('/topic/messages', function (message) {
                showMessage(JSON.parse(message.body));
            });
        });
    }

    function sendMessage() {
        let sender = document.getElementById('username').value.trim();
        let content = document.getElementById('message').value.trim();
        if (sender && content) {
            stompClient.send("/app/sendMessage", {}, JSON.stringify({'sender': sender, 'content': content}));
            document.getElementById('message').value = '';
        }
    }

    function showMessage(message) {
        let chatBox = document.getElementById('chat-box');
        let msg = document.createElement('div');
        msg.textContent = message.sender + ": " + message.content;
        chatBox.appendChild(msg);
        chatBox.scrollTop = chatBox.scrollHeight;
    }

    connect();
</script>
</body>
</html>
